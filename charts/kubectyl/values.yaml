# Default values for Kubectyl.
database:
  type: mariadb 

global:
  timezone: UTC

ingress:
  class: nginx
  panel: panel.example.com
  kuber: kuber.example.com
  tls:
    create: true
    clusterIssuer: letsencrypt-prod
    secretName: "kubectyl-tls"
  annotations: {}

panel:
  image: ghcr.io/raefon/panel:latest
  imagePullPolicy: "Always"
  storageClass: ""
  existingVolumeClaim: ""
  email: abc@example.com
  serviceAnnotations: {}
  statefulSetAnnotations: {}

kuber:
  image: ghcr.io/raefon/kuber:develop
  imagePullPolicy: "Always"
  replicaCount: 1 # Increased to 1 as default for functionality
  serviceAnnotations: {}
  deploymentAnnotations: {}
  initContainers:
    - name: tmp
      image: busybox:latest
      command: ["sh", "-c", "cp /tmp/kubectyl/config.yml /etc/kubectyl/config.yml && chmod 777 /etc/kubectyl/config.yml"]
      volumeMounts:
        - name: config
          mountPath: "/tmp/kubectyl"
        - name: tmp
          mountPath: "/etc/kubectyl"
    - name: configure-kuber
      image: mikefarah/yq:4
      command: 
        - "sh"
        - "-c"
        - |
          yq --inplace '.api.port = 80' /etc/kubectyl/config.yml
          yq --inplace '.api.ssl.enabled = false' /etc/kubectyl/config.yml
          yq --inplace '.system.sftp.sftp_image = "ghcr.io/raefon/sftp-server:latest"' /etc/kubectyl/config.yml
      volumeMounts:
        - name: tmp
          mountPath: "/etc/kubectyl"

# MariaDB 11.8+ Configuration
mariadb:
  enabled: true
  architecture: standalone
  auth:
    database: panel
    username: kubectyl
    password: "SecretPassword" # Use quotes for safety with special chars
    rootPassword: "SuperSecretPassword"
  primary:
    persistence:
      enabled: true
      size: 1Gi
    # MariaDB 11+ uses improved buffer pool management; default resources are usually fine
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
  secondary:
    replicaCount: 0

# Redis 8.x Configuration
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true # Security best practice for Redis 8.x
    password: "RedisSecretPassword"
    sentinel: false
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
  replica:
    replicaCount: 0

# External Postgres (Fallback)
postgres:
  externalHost: ""
  auth:
    database: panel
    username: kubectyl
    password: "SecretPassword"

serviceAccount:
  create: true
  name: ""